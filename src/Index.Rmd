---
title: "Concepts of multilevel, longitudinal, and mixed models: Group 3"
author: 
  - "Robrecht Van Der Bauwhede"
  - "Renée Blanckaert Group"
  - "Charlotte Vercammen Group"
  - "Raïsa Carmen"
output: 
  bookdown::pdf_document2:
    keep_tex:  true
---

```{r setup, include=FALSE}
library(tidyverse)
library(kableExtra)
library(here)
library(haven) #to read sas data
library(lme4)# http://lme4.r-forge.r-project.org/book/
library(lmerTest)# calculates pvalues for the models
library(nlme)
library(cowplot)

knitr::opts_chunk$set(echo = TRUE)

data <- read_sas(sprintf("%s/data/mmse.sas7bdat",here())) %>%
  mutate(id = as.factor(id),
         NEURO = recode_factor(as.factor(NEURO), "0" = "not neuro-psychiatric", 
                              "1" = "neuro-psychiatric"),
         housing = recode_factor(as.factor(housing), "1" = "alone",
                                 "2" = "with family or partner", 
                                 "3" = "nursing home")) 

```

# Introduction
The data set results from a longitudinal observational study, the aim of which is to
study the post-operative evolution of the cognitive status of elderly hipfracture patients and their pre-operative
cognitive status, and to study the effects of housing situation and age on these evolutions.
The physical ability is measured using the MMSE (Mini Mental State Examination) score, with values between 0
and 30, where low values correspond to a bad cognitive condition, while high scores correspond to high cognitive
condition of the patient. The pre-operative cognitive status is measured through the so-called ‘neuro-status’
which is a binary indicator for being neuro-psychiatric.

- id: patient identification number
- age: age of the patient at entry
- neuro: neuro-psychiatric status of the patient (1: neuro-psychiatric, 0: not neuro-psychiatric)
- mmse: MMSE score
- time: day after operation at which the MMSE score has been measured (1, 3, 5, 8, or 12)
- housing: the housing situation prior to the hip fracture (1: alone, 2: with family or partner, 3: nursing
home)


# Data exploration

Considering the completeness of the data, it can be observed that `r n_distinct(data[is.na(data$housing),"id"])` persons' housing situation is unknown. Additionally, there was some dropout over time as show in Table \@ref(tab:EDAdropout). The column "Nb" shows the number of respondent at each time instance. The column "Return" shows the number of respondents that participated at time $t$ while they did not participate at time $t-1$; there is, for instance, one respondent that did not participate at $time = 1$ while he did participate at $time = 3$. The column "Dropout" shows the number of respondents that did not participate at time $t$ while they did participate at time $t-1$. It can be seen than many drop out at $time = 12$. The other columns show how the patient characteristics change over time as patients are added or lost from the study. Overall, there is not much variation which might indicate that the dropout of patients is not related to MMSE or patient characteristics. We will thus assume dropout is completely random.

```{r EDAdropout, echo = F}
data %>% group_by(time) %>%
  summarize(nb = n_distinct(id),
            avgage = mean(age),
            avgneuro = 100*mean(NEURO == "neuro-psychiatric"),
            avgalone = 100*mean(!is.na(housing) & housing == "alone"),
            avgfp = 100*mean(!is.na(housing) & housing == "with family or partner"),
            avgnurse = 100*mean(!is.na(housing) & housing == "nursing home"),
            avgna = 100*mean(is.na(housing))) %>%
  ungroup() %>%
  mutate(return = ifelse(time == 3,
                            sum(!(unlist(unique(data[data$time == 3, 'id'])) %in% unlist(unique(data[data$time == 1, 'id'])))),
                            ifelse(time == 5,
                                   sum(!(unlist(unique(data[data$time == 5, 'id'])) %in% unlist(unique(data[data$time == 3, 'id'])))), 
                                   ifelse(time == 8,
                                          sum(!(unlist(unique(data[data$time == 8, 'id'])) %in% unlist(unique(data[data$time == 5, 'id'])))),
                                          ifelse(time == 12,
                                                 sum(!(unlist(unique(data[data$time == 15, 'id'])) %in% unlist(unique(data[data$time == 12, 'id'])))),
                                                 0)))),
         dropout = lag(nb,1) - nb + return) %>%
  replace_na(list(dropout = 0)) %>% 
  dplyr::select(time, nb, return, dropout, avgage, avgneuro, avgalone, avgfp, 
                avgnurse, avgna) %>%
  kable(col.names = c("Time", "Nb", "Return", "Dropout", "Mean age", 
                      "% neuro-psychiatric", "%alone", "%family/ partner", 
                      "%nursing home", "%NA"),
        digits = 2,
        caption = "Dropout and patient characteristics over time.",
        booktabs = T) %>%
  kable_styling() %>%
  add_header_above(c(" " = 6, "Housing" = 4)) %>%
  column_spec(1:5, width = "0.8cm") %>%
  column_spec(6, width = "1.4cm") %>%
  column_spec(7, width = "1.2cm") %>%
  column_spec(8:9, width = "1.45cm") %>%
  column_spec(10, width = "0.8cm") 
```


Figure \@ref(fig:EDAMMSEtime) shows the average evolution of MMSE over time (Loess curves) for groups of patients with different housing and/or neuro-psychiatric status. Patients that are not neuro-psychiatric seem to have higherMMSE that stays reasonably constant over time (except for nursing home patients). MMSE seems to go up over time for nursing home patients (but they are the smallest group), and down for neuro-spychiatric patients that live with their family or partner (or unknown housing). MMSE for neuro-psychiatric patients that live alone might have a quadratic evolution over time. 

```{r EDAMMSEtime, echo = FALSE, message= FALSE, warning = FALSE, fig.cap = "MMSE over time for all patient profiles, including smoothed curves."}
ggplot(data) + 
  geom_point(aes(x = time, y = mmse, color = housing, shape = NEURO)) +
  geom_smooth(aes(x = time, y = mmse, color = housing, linetype = NEURO),
              alpha = 0, method = "loess") +
  ylim(0, 31) +
  theme_bw()
```

Figure \@ref(fig:EDApatientprofiles) shows all patient profiles.  There is quite a lot of variation between the patients' evolution. The non-psychiatric patients are also under-represented (except in the nursing home group).

```{r EDApatientprofiles, echo = FALSE, message= FALSE, warning = FALSE, fig.cap = "Patient profiles of MMSE over time."}
A <- data %>% group_by(housing, NEURO) %>%
  summarize(n = n_distinct(id)) %>%
  filter(!is.na(housing)) %>%
  ungroup() %>%
  mutate(label = sprintf("n = %.0f",n))
ggplot() + 
  geom_line(data = data[!is.na(data$housing),],
            aes(x = time, y = mmse, group = id)) +
  geom_text(data = A, x = 10, y = 32, aes(label = label)) +
  facet_grid(rows = vars(NEURO), cols = vars(housing)) +
  ylim(0, 35) +
  scale_x_continuous(breaks = c(1,3,5,8,12), labels = c(1,3,5,8,12)) +
  theme_bw() 
```

The last variable that is explored, is the age. The loess curves in Figure \@ref(fig:EDAage) show that age might be negatively correlated with MMSE.

```{r EDAage, echo = FALSE, message= FALSE, warning = FALSE, fig.cap = "MMSE versus age. Facets show the time instances."}
ggplot(data) + 
  geom_point(aes(x = age, y = mmse, color = housing, shape = NEURO)) +
  geom_smooth(aes(x = age, y = mmse)) +
  facet_wrap(vars(as.factor(time)), nrow = 2) +
  ylim(0, 31) +
  theme_bw() 
```

## Variance analysis and correlation structure

Figure \@ref(fig:EDAvar) shows that the variance is larger for the neuro-psychiatric patients (the smallest group).


```{r EDAvar, echo = FALSE, message= FALSE, warning = FALSE, fig.cap = "Error bars with 95 percent confidence intervals."}
datasummary <- data %>%
  group_by(NEURO, time) %>%
  summarize(mean = mean(mmse),
            var = var(mmse),
            n = n(),
            lci95 = mean - qnorm(.975)*sqrt(var)/sqrt(n),
            uci95 = mean + qnorm(.975)*sqrt(var)/sqrt(n)
            ) %>%
  ungroup()
ggplot(datasummary) + 
  geom_errorbar(aes(x = time, ymin = lci95, ymax = uci95)) +
  geom_line(aes(x = time, y = mean)) +
  facet_wrap(vars(as.factor(NEURO)), nrow = 1) +
  ylim(0, 31) +
  theme_bw() 


```

Figure \@ref(fig:EDAvarmean) shows that there seems to be an inverse relationship between the mean mmse and the variance for patients with either neuro-psychiatric status.



```{r EDAvarmean, echo = FALSE, message= FALSE, warning = FALSE, fig.cap = "Error bars with 95% confidence intervals."}
p1 <- ggplot(datasummary) + 
  geom_point(aes(x = mean, y = var, color = as.factor(time), shape = NEURO)) +
  xlab('Mean mmse') + ylab("Variance mmse") +
  scale_color_discrete(name = "time") +
  theme_bw() 
```


```{r intraclasscorrelation, include = FALSE, echo =TRUE, message = FALSE, warning = FALSE}
A <- data %>% dplyr::select(id, time, mmse) %>%
  pivot_wider(names_from = id, values_from = mmse) %>%
  dplyr::select(-time) %>%
  as.data.frame()

library(psych)
ICC(A)
library("irr")
icc(A, model = "twoway",
  type = "agreement", unit = "single")
library('irrNA')
i <- iccNA(A)
```

## Conclusion exploratory analysis

The exploratory analysis has shows that the pattern of mmse over time is likely not constant or even linear. One might attempt quadratic, cubic, or logarithmic transformations of time to accommodate this. Both the level (intercept) of mmse differs quite a lot, depending on  neuro-psychiatric status, housing and age.

There seems to be high intraclass correlation???

# Methodology and results

This section, gradually develops a statistical model that seems to fit the data best. It starts with a simple model where only limited covariates are included in  \@ref(M1)

## A simple model{#M1}
This first, simple model will assume a linear relationship between mmse and $log(time)$ for each patient. The model allows for subject-specific intercepts and slopes and the neuro-psychiatric status is the only additional explanatory variable that is taken into account. 

```{r simplelinear, include = FALSE, echo = FALSE, message = FALSE, warning = FALSE}
#A simple linear model
fm0 <- lm(mmse ~ time + NEURO + NEURO * time, data = data)
par(mfrow = c(2, 3))
data %>% mutate(residuals = resid(fm0),
                     fitted = fitted(fm0)) %>%
  ggplot() + geom_line(aes(x = time, y = residuals, group = id)) + 
  facet_grid(rows = vars(housing), cols = vars(NEURO)) +
  ylab('residuals') + 
  theme_bw()
#If model is appropriate, residuals should fluctuate randomly around zero. That is clearly not so.

data %>% mutate(residuals = resid(fm0),
                     fitted = fitted(fm0)) %>%
  ggplot() + geom_line(aes(x = time, y = fitted, group = id, color = NEURO)) +
  ylab('fitted value') + 
  theme_bw()
```


```{r simplemixed, include = FALSE, echo = FALSE, message = FALSE, warning = FALSE}
#only random intercept
data$logtime <- log(data$time)
fm1 <- lmer(mmse ~ logtime + NEURO + NEURO * logtime + (1|id), data = data)
data %>% mutate(residuals = resid(fm1),
                     fitted = fitted(fm1)) %>%
  ggplot() + geom_line(aes(x = time, y = residuals, group = id)) + 
  facet_grid(rows = vars(housing), cols = vars(NEURO)) +
  ylab('residuals') + 
  theme_bw()
#There already seems to be less of a pattern
data %>% mutate(residuals = resid(fm1),
                     fitted = fitted(fm1)) %>%
  ggplot() + geom_line(aes(x = time, y = fitted, group = id, color = NEURO)) +
  ylab('fitted value') + 
  theme_bw()
```

```{r simplemixedmodel, include = TRUE, echo = FALSE, message = FALSE, warning = FALSE}
#random intercept and slope
fm2 <- lmerTest::lmer(mmse ~ logtime + NEURO + NEURO * logtime + (1 + logtime|id), data = data) #boundary (singular) fit: see ?isSingular
#isSingular(fm2) #TRUE if time is used in stead of logtime!
sfm2 <- summary(fm2)
```
Table \@ref(tab:simplemixed2) shows the fixed effects for the simple model where time is on a log scale, with a random intercept and slope. For the average not-neuro-psychiatric patient, the slope is positive and the intercept is at `r sfm2$coefficients[1,1]`. For the average neuro-psychiatric patients, the intercept is at `r sfm2$coefficients[1,1] + sfm2$coefficients[3,1]` and the slope is less steep (as shown in Figure \@ref(fig:simplemixedfitted)) but the difference in slope is not significant. 

Figure \@ref(fig:simplemixedresiduals) shows that the model performs reasonably well; there are no real remaining trends (all curves going up or down) and most residuals seem to randomly fluctuate around zero (no profiles are consistently above or below zero). There are, however, some individuals whose residuals are far larger (both positive and negative) than others.

Figure \@ref(fig:simplemixedscatter) shows the inverse relationship between the slope and the intercept: the higher the intercept, the lower the slope for each of the neuro-psychiatric statuses. This makes sense because MMSE is not a real continuous variable. It has a maximum value of 30 which means that there is less room for an increase in MMSE (meaning a lower slope) if the starting value (intercept) for MMSE is already high. 

```{r simplemixed2, include = TRUE, echo = FALSE, message = FALSE, warning = FALSE}
sfm2$coefficients %>% kable(caption = "Fixed effects for the simple model with random intercept and slope",
                            booktabs = TRUE, digits = 3)
```

```{r simplemixedvarcov, include = TRUE, echo = FALSE, message = FALSE, warning = FALSE}
sfm2$varcor[1]$id[1:2,] %>% kable(caption = "variance-coviarance matrix.",
                            booktabs = TRUE, digits = 3)
```

```{r simplemixedstddev, include = TRUE, echo = FALSE, message = FALSE, warning = FALSE}
varcor <- lapply(sfm2$varcor, attributes)
varcor$id$stddev %>% kable(caption = "Standard deviations.",
                            booktabs = TRUE, digits = 3)
```

```{r simplemixedcorrelation, include = TRUE, echo = FALSE, message = FALSE, warning = FALSE}
varcor$id$correlation %>% kable(caption = "Correlations.",
                            booktabs = TRUE, digits = 3)
```

```{r simplemixedresiduals, include = TRUE, echo = FALSE, message = FALSE, warning = FALSE, fig.cap = "Residuals and time."}
data %>% mutate(residuals = resid(fm2),
                     fitted = fitted(fm2)) %>%
  ggplot() + geom_line(aes(x = time, y = residuals, group = id)) + 
  facet_grid(rows = vars(housing), cols = vars(NEURO)) +
  ylab('residuals') + 
  theme_bw()
#There already seems to be less of a pattern
```

```{r simplemixedfitted, include = TRUE, echo = FALSE, message = FALSE, warning = FALSE, fig.cap = "Fitted values plotted against log(time) and time. Dashed, thicker lines are the predicted trends based on the fixed effects only, for each group."}
sfm2avg <- data.frame(NEURO = levels(data$NEURO),
                      intercept = c(sfm2$coefficients[1,1], 
                                    sfm2$coefficients[1,1] + sfm2$coefficients[3,1]),
                      slope = c(sfm2$coefficients[2,1], 
                                sfm2$coefficients[2,1] + sfm2$coefficients[4,1]))
sfm2avgline <- data.frame(time = unique(data$time)) %>%
  mutate(logtime = log(time),
         `not neuro-psychiatric` = sfm2avg$intercept[1] + logtime * sfm2avg$slope[1],
         `neuro-psychiatric` = sfm2avg$intercept[2] + logtime * sfm2avg$slope[2]) %>%
  pivot_longer(cols = 3:4, names_to = "NEURO", values_to = "fitted") 
p1 <- data %>% mutate(residuals = resid(fm2),
                     fitted = fitted(fm2)) %>%
  ggplot() + geom_line(aes(x = logtime, y = fitted, group = id, 
                           color = NEURO)) +
  geom_abline(data = sfm2avg, aes(slope = slope, intercept = intercept, 
                                  color = NEURO), 
              size = 2, linetype = 2) +
  ylab('fitted value') + 
  theme_bw() +
  xlab("log(time)")
p2 <- data %>% mutate(residuals = resid(fm2),
                     fitted = fitted(fm2)) %>%
  ggplot() + geom_line(aes(x = time, y = fitted, group = id, color = NEURO)) +
  geom_line(data = sfm2avgline, aes(x = time, y = fitted, color = NEURO), 
            size = 2, linetype = 2) +
  ylab('fitted value') + 
  theme_bw()
p <- plot_grid(p1 + theme(legend.position = "none"), 
               p2 + theme(legend.position = "none"), nrow = 1)
legend <- get_legend(
  p1 + theme(legend.box.margin = margin(0, 0, 0, 12))
)
plot_grid(p,legend,rel_widths = c(3,1))
```

```{r simplemixedscatter, include = TRUE, echo = FALSE, message = FALSE, warning = FALSE, fig.cap = "Scatterplot of the fitted intercept and slopes (log(time))."}
data %>% group_by(id) %>%
  summarize(NEURO = first(NEURO)) %>%
  ungroup() %>%
  cbind(coef(fm2)$id) %>%
  mutate(intercept = `(Intercept)` + (NEURO == "neuro-psychiatric")*`NEUROneuro-psychiatric`,
         slope = logtime + (NEURO == "neuro-psychiatric")*`logtime:NEUROneuro-psychiatric`) %>%
  ggplot() + geom_point(aes(x = intercept, y = slope, color = NEURO)) +
  theme_bw()
```

## Model with housing and age   
```{r mixedcov, include = TRUE, echo = FALSE, message = FALSE, warning = FALSE}
#random intercept and slope
data$agecenter <- data$age - mean(data$age)
fm3 <- lmerTest::lmer(mmse ~ logtime + NEURO + NEURO * logtime + agecenter + housing + (1 + logtime|id), data = data) #boundary (singular) fit: see ?isSingular
#isSingular(fm2) #TRUE if time is used in stead of logtime!
sfm3 <- summary(fm3)
```
Before adding age to the model, it is centered around the mean (mean age is `r round(mean(data$age), digits = 2)`).
Table \@ref(tab:mixedcov2) shows the results for the fixed effects. Non neuro-phsychiatric patients that are `r round(mean(data$age), digits = 2)` years old and live alone are the baseline and have the highest intercept (`r round(sfm3$coefficients[1,1], digits = 2)`). For each increase in age of one year, the intercept is estimated to be `r sfm3$coefficients[1,4]` lower and neuro-psychiatric patients still have lower intercept and slope. Patients that live with family or partner have slightly lower intercept (not significant) than those who live alone. Patients that live in a nursing home have a significantly lower intercept than those who live alone. There is no significant difference in slope between neuro-psychiatric and non neuro-psychiatric patients.

```{r mixedcov2, include = TRUE, echo = FALSE, message = FALSE, warning = FALSE}
sfm3$coefficients %>% kable(caption = "Fixed effects for a model with random intercept and slope, including age and housing",
                            booktabs = TRUE, digits = 3)
```

```{r mixedvarcov, include = TRUE, echo = FALSE, message = FALSE, warning = FALSE}
sfm3$varcor[1]$id[1:2,] %>% kable(caption = "variance-coviarance matrix.",
                            booktabs = TRUE, digits = 3)
```

```{r mixedstddev, include = TRUE, echo = FALSE, message = FALSE, warning = FALSE}
varcor <- lapply(sfm3$varcor, attributes)
varcor$id$stddev %>% kable(caption = "Standard deviations.",
                            booktabs = TRUE, digits = 3)
```

```{r mixedcorrelation, include = TRUE, echo = FALSE, message = FALSE, warning = FALSE}
varcor$id$correlation %>% kable(caption = "Correlations.",
                            booktabs = TRUE, digits = 3)
```


```{r mixedcovtests, include = FALSE, echo = FALSE, message = FALSE, warning = FALSE}
#random intercept and slope, time*housing added
fm4 <- lmerTest::lmer(mmse ~ logtime + NEURO + housing * logtime + agecenter + housing + (1 + logtime|id), data = data) #boundary (singular) fit: see ?isSingular
#isSingular(fm2) #TRUE if time is used in stead of logtime!
sfm4 <- summary(fm4)
fm5 <- lmerTest::lmer(mmse ~ logtime + NEURO + agecenter * logtime + agecenter + housing + (1 + logtime|id), data = data) #boundary (singular) fit: see ?isSingular
#isSingular(fm2) #TRUE if time is used in stead of logtime!
sfm5 <- summary(fm5)
```


```{r mixedcovfitted, include = TRUE, echo = FALSE, message = FALSE, warning = FALSE, fig.cap = "Fitted values plotted against log(time) and time. Dashed, thicker lines are the predicted trends based on the fixed effects only, for an average-aged patient in each group.", fig.height = 15, fig.width = 10}
sfm3avg <- expand_grid(housing = levels(data$housing), 
                       NEURO = levels(data$NEURO)) %>%
  mutate(intercept = sfm3$coefficients[1,1] + 
           ifelse(NEURO == "neuro-psychiatric", sfm3$coefficients[3,1], 0) +
           ifelse(housing == "with family or partner", sfm3$coefficients[5,1], 
                  ifelse(housing == "nursing home", sfm3$coefficients[6,1], 0)),
         slope = sfm3$coefficients[2,1] + 
           ifelse(NEURO == "neuro-psychiatric", sfm3$coefficients[7,1], 0))
sfm3avgline <- expand_grid(time = unique(data$time), 
                           housing = levels(data$housing), 
                           NEURO = levels(data$NEURO)) %>%
  mutate(logtime = log(time)) %>%
  left_join(sfm3avg) %>%
  mutate(fitted  = intercept + logtime*slope)
p1 <- data %>% mutate(residuals = resid(fm2),
                     fitted = fitted(fm2)) %>%
  ggplot() + geom_line(aes(x = logtime, y = fitted, group = id, 
                           color = housing)) +
  geom_line(data = sfm3avgline, aes(x = logtime, y = fitted, 
                           color = housing), 
              size = 2, linetype = 2) +
  facet_wrap(vars(NEURO), nrow = 2) +
  ylab('fitted value') + 
  theme_bw() +
  xlab("log(time)")
p2 <- data %>% mutate(residuals = resid(fm2),
                     fitted = fitted(fm2)) %>%
  ggplot() + geom_line(aes(x = time, y = fitted, group = id, color = housing)) +
  geom_line(data = sfm3avgline, aes(x = time, y = fitted, color = housing), 
            size = 2, linetype = 2) +
  facet_wrap(vars(NEURO), nrow = 2) +
  ylab('fitted value') + 
  theme_bw()
p <- plot_grid(p1 + theme(legend.position = "none"), 
               p2 + theme(legend.position = "none"), nrow = 1)
legend <- get_legend(
  p1 + theme(legend.box.margin = margin(0, 0, 0, 12))
)
plot_grid(p,legend,rel_widths = c(3,1))
```


## A model with a dichotomized dependent variable

### Median split
Lastly, a model is tested where mmse is dichotomized using a median split; all mmse scores equal to or below the median (`r median(data$mmse)`) are cetagorized as "Low" and all mmse scores over `r median(data$mmse)` are categorized as "High". It should be noted that the literature warns against this technique as it is rarely justified from either a conceptual or statistical perspective [@maccallum2002practice].

```{r mixeddictests, include = TRUE, echo = FALSE, message = FALSE, warning = FALSE}
data$bmmse <- factor(as.factor(ifelse(data$mmse <= median(data$mmse),"Low","High")), levels = c("Low","High"))
fm6 <- glmer(bmmse ~ logtime + NEURO + NEURO * logtime + agecenter + housing + (1 + logtime|id), 
             data = data, family = binomial(link = "logit")) #In checkConv(attr(opt, "derivs"), opt$par, ctrl = control$checkConv,  :
  #Model failed to converge with max|grad| = 0.187143 (tol = 0.002, component 1)
sfm6 <- summary(fm6)
```

In this model, nothing is significant. It seems we've indeed lost a lot of information by dichotomizing the dependent variable.
```{r mixeddic, include = TRUE, echo = FALSE, message = FALSE, warning = FALSE}
sfm6$coefficients %>% kable(caption = "Fixed effects for a model with random intercept and slope, including age and housing, dichotomized dependent variable (median split)",
                            booktabs = TRUE, digits = 3)
```

```{r mixeddicvarcov, include = TRUE, echo = FALSE, message = FALSE, warning = FALSE}
sfm6$varcor[1]$id[1:2,] %>% kable(caption = "variance-coviarance matrix.",
                            booktabs = TRUE, digits = 3)
```

```{r mixeddicstddev, include = TRUE, echo = FALSE, message = FALSE, warning = FALSE}
varcor <- lapply(sfm6$varcor, attributes)
varcor$id$stddev %>% kable(caption = "Standard deviations.",
                            booktabs = TRUE, digits = 3)
```

```{r mixeddiccorrelation, include = TRUE, echo = FALSE, message = FALSE, warning = FALSE}
varcor$id$correlation %>% kable(caption = "Correlations.",
                            booktabs = TRUE, digits = 3)
```

### Dichotomized at 25
The maximum score for the MMSE is 30. A score of 25 or higher is classed as normal. If the score is below 24, the result is usually considered to be abnormal, indicating possible cognitive impairment.


```{r mixeddictests2, include = TRUE, echo = FALSE, message = FALSE, warning = FALSE}
data$bmmse <- factor(as.factor(ifelse(data$mmse <= 24,"abnormal","normal")), levels = c("abnormal","normal"))
fm7 <- glmer(bmmse ~ logtime + NEURO + NEURO * logtime + agecenter + housing + (1 + logtime|id), 
             data = data, family = binomial(link = "logit")) #In checkConv(attr(opt, "derivs"), opt$par, ctrl = control$checkConv,  :
  #Model failed to converge with max|grad| = 0.428569 (tol = 0.002, component 1)
sfm7 <- summary(fm7)
```

In this model, nothing is significant. It seems we've indeed lost a lot of information by dichotomizing the dependent variable.
```{r mixeddic2, include = TRUE, echo = FALSE, message = FALSE, warning = FALSE}
sfm7$coefficients %>% kable(caption = "Fixed effects for a model with random intercept and slope, including age and housing, dichotomized dependent variable (split at 25).",
                            booktabs = TRUE, digits = 3)
```

```{r mixeddicvarcov2, include = TRUE, echo = FALSE, message = FALSE, warning = FALSE}
sfm7$varcor[1]$id[1:2,] %>% kable(caption = "variance-coviarance matrix.",
                            booktabs = TRUE, digits = 3)
```

```{r mixeddicstddev2, include = TRUE, echo = FALSE, message = FALSE, warning = FALSE}
varcor <- lapply(sfm7$varcor, attributes)
varcor$id$stddev %>% kable(caption = "Standard deviations.",
                            booktabs = TRUE, digits = 3)
```

```{r mixeddiccorrelation2, include = TRUE, echo = FALSE, message = FALSE, warning = FALSE}
varcor$id$correlation %>% kable(caption = "Correlations.",
                            booktabs = TRUE, digits = 3)
```

# Conclusion
 
# Bibliography
